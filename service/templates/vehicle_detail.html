{% extends "home.html" %}
{% load static %}
{% block main_content %}

<h1>{{ vehicle.type }}</h1>
<img src="{{ vehicle.image.url }}" alt="{{ vehicle.type }}">
<p>Thời gian thuê phòng: {{ booking.date_start|date:"d/m/Y" }} - {{ booking.date_end|date:"d/m/Y" }}</p>
<p>Biển số: {{ vehicle.license_plate }}</p>
<p>Sức chứa: {{ vehicle.capacity }}</p>
<p>Giá thuê theo ngày: ${{ vehicle.daily_rate }}</p>
<p>Giá thuê theo giờ: ${{ vehicle.hour_rate }}</p>
<p>Số xe còn lại: {{ vehicle.available }}</p>

<button id="book-vehicle-btn" class="btn btn-primary">Đặt xe</button>

<!-- Form chọn ngày giờ -->
<div id="vehicle-booking-form" style="display: none;">
    <label for="rental_time">Ngày giờ bắt đầu:</label>
    <input type="datetime-local" id="rental_time" name="rental_time" required>
    
    {% comment %} <label for="return_time">Ngày giờ kết thúc:</label> {% endcomment %}
    {% comment %} <input type="datetime-local" id="return_time" name="return_time" required> {% endcomment %}
    
    <button type="button" id="confirm-booking-btn" class="btn btn-success">Xác nhận</button>
</div>

<script>
    {% comment %} function chuyenHuong() {
        window.location.href = "{% url 'ten_view' %}";
    } {% endcomment %}

    document.getElementById('book-vehicle-btn').addEventListener('click', function() {
        document.getElementById('vehicle-booking-form').style.display = 'block';
    });
 
    document.getElementById('confirm-booking-btn').addEventListener('click', function() {
        // Lấy giá trị ngày giờ từ form
        const rentalTime = new Date(document.getElementById('rental_time').value);
        {% comment %} const returnTime = new Date(document.getElementById('return_time').value); {% endcomment %}
 
        // Kiểm tra thời gian nằm trong quãng thời gian thuê phòng
        const roomStartTime = new Date('{{ booking.date_start|date:"Y-m-d\\TH:i" }}');
        const roomEndTime = new Date('{{ booking.date_end|date:"Y-m-d\\TH:i" }}');
 
        if (rentalTime >= roomStartTime && rentalTime <= roomEndTime) {
            // Gửi dữ liệu đặt xe đến server
            fetch('{% url "service:book_vehicle" vehicle.id %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    rental_time: rentalTime.toISOString(),
                    {% comment %} return_time: returnTime.toISOString() {% endcomment %}
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Đặt xe thành công!');
                    // Chuyển hướng hoặc cập nhật giao diện
                } else {
                    alert('Có lỗi xảy ra, vui lòng thử lại.');
                }
            })
            .catch(error => console.error('Error:', error));
        } else {
            alert('Thời gian đặt xe phải nằm trong quãng thời gian thuê phòng.');
        }
    });
</script>

{% endblock main_content %}